# Intermediate Guide (nodejs version)

This guide details using Blanket.js with a mocha testrunner, and the travis-cov reporter in NodeJS.

It is assumed you have already read the Getting Started guide.

To begin you will need:  
* an existing mocha tests/test runner (including the mocha module, `npm install mocha -g`)
* source files

1. Install Blanket: `npm install blanket`

2. Add the following to top of your test runner file:

<<<<<<< HEAD
=======
<<<<<<< HEAD
    ```var blanket = require("blanket");
blanket.setFilter("/source/");

/* 
... where `/source/` matches partially or fully the directory where the source files to be instrumented are stored.  
You can also provide an array of regular expression.  
*/```
=======
>>>>>>> coffee_script
    `var blanket = require("blanket"); blanket.setFilter("/source/");`
 
    ... where `/source/` matches partially or fully the directory where the source files to be instrumented are stored.  
    You can also provide an array of regular expression.  
<<<<<<< HEAD
=======
>>>>>>> 19b9e88c55dad66551ad41c6edf5dcba676953a4
>>>>>>> coffee_script

3. Omitting the second line will default to "src".  Additionally, any value provided there will override values set in the package.json file.

4. Since we've explicit referenced blanket we don't need to require it in the mocha command.

5. Install the travis-cov reporter: `npm install travis-cov`

6. We will set the coverage threshold in the package.json file.  The following will set the coverage threshold at 70%.  Any tests falling below 70% will fail, and (when run on travis-ci) will cause the build to fail:

<<<<<<< HEAD
=======
<<<<<<< HEAD
    ```"scripts": {
    "travis-cov": {
      "threshold": 70
    }
}```
=======
>>>>>>> coffee_script
    ` "scripts": {
    "travis-cov": {
      "threshold": 70
    }
}`
<<<<<<< HEAD
=======
>>>>>>> 19b9e88c55dad66551ad41c6edf5dcba676953a4
>>>>>>> coffee_script

7. Use the travis-cov reporter to display coverage percentage:

```mocha <path to test runner> -R travis-cov```

